(function(l){window.TESTS={};Q.TestPage=Q.Page.extend({run:function(u){this._super();for(var w in TESTS){l.log('Running "',w,'"...');TESTS[w](u)}}})})(jQuery);(function(l){function u(){if(e.doneTimer&&l.clearTimeout){l.clearTimeout(e.doneTimer);e.doneTimer=null}if(e.queue.length){if(B.setTimeout)e.doneTimer=l.setTimeout(function(){e.queue.length?r(u):u()},13)}else{e.autorun=true;e.currentModule&&h.moduleDone(e.currentModule,e.moduleStats.bad,e.moduleStats.all);var b=o("qunit-banner"),c=o("qunit-tests"),d=["Tests completed in ",+new Date-e.started,' milliseconds.<br/><span class="passed">',e.stats.all-e.stats.bad,'</span> tests of <span class="total">',
e.stats.all,'</span> passed, <span class="failed">',e.stats.bad,"</span> failed."].join("");if(b)b.className=e.stats.bad?"qunit-fail":"qunit-pass";if(c){b=o("qunit-testresult");if(!b){b=document.createElement("p");b.id="qunit-testresult";b.className="result";c.parentNode.insertBefore(b,c.nextSibling)}b.innerHTML=d}h.done(e.stats.bad,e.stats.all)}}function w(b){var c=e.filters.length,d=false;if(!c)return true;for(;c--;){var f=e.filters[c],j=f.charAt(0)=="!";if(j)f=f.slice(1);if(b.indexOf(f)!==-1)return!j;
if(j)d=true}return d}function v(b){if(!b)return"";b+="";return b.replace(/[\&"<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return'"';case "<":return"&lt;";case ">":return"&gt;";default:return c}})}function r(b){e.queue.push(b);e.autorun&&!e.blocking&&x()}function x(){for(var b=(new Date).getTime();e.queue.length&&!e.blocking;)if(e.updateRate<=0||(new Date).getTime()-b<e.updateRate)e.queue.shift()();else{l.setTimeout(x,13);break}}function y(){e.pollution=[];
if(e.noglobals)for(var b in l)e.pollution.push(b)}function C(b,c){for(var d=b.slice(),f=0;f<d.length;f++)for(var j=0;j<c.length;j++)if(d[f]===c[j]){d.splice(f,1);f--;break}return d}function D(b,c,d){if(typeof console!=="undefined"&&console.error&&console.warn){console.error(b);console.error(c);console.warn(d.toString())}else l.opera&&opera.postError&&opera.postError(b,c,d.toString)}function t(b,c){for(var d in c)b[d]=c[d];return b}function A(b,c,d){if(b.addEventListener)b.addEventListener(c,d,false);
else b.attachEvent?b.attachEvent("on"+c,d):d()}function o(b){return!!(typeof document!=="undefined"&&document&&document.getElementById)&&document.getElementById(b)}function E(b){for(var c="",d,f=0;b[f];f++){d=b[f];if(d.nodeType===3||d.nodeType===4)c+=d.nodeValue;else if(d.nodeType!==8)c+=E(d.childNodes)}return c}var B={setTimeout:typeof l.setTimeout!=="undefined"},h={module:function(b,c){e.currentModule=b;r(function(){e.previousModule&&h.moduleDone(e.currentModule,e.moduleStats.bad,e.moduleStats.all);
e.previousModule=e.currentModule;e.currentModule=b;e.moduleTestEnvironment=c;e.moduleStats={all:0,bad:0};h.moduleStart(b,c)})},asyncTest:function(b,c,d){if(arguments.length===2){d=c;c=0}h.test(b,c,d,true)},test:function(b,c,d,f){var j='<span class="test-name">'+b+"</span>",g,a;if(arguments.length===2){d=c;c=null}if(c&&typeof c==="object"){a=c;c=null}if(e.currentModule)j='<span class="module-name">'+e.currentModule+"</span>: "+j;if(w(e.currentModule+": "+b)){r(function(){g=t({setup:function(){},teardown:function(){}},
e.moduleTestEnvironment);a&&t(g,a);h.testStart(b,g);h.current_testEnvironment=g;e.assertions=[];e.expected=c;var i=o("qunit-tests");if(i){var k=document.createElement("strong");k.innerHTML="Running "+j;var m=document.createElement("li");m.appendChild(k);m.id="current-test-output";i.appendChild(m)}try{e.pollution||y();g.setup.call(g)}catch(n){h.ok(false,"Setup failed on "+j+": "+n.message)}});r(function(){f&&h.stop();try{d.call(g)}catch(i){D("Test "+j+" died, exception and test follows",i,d);h.ok(false,
"Died on test #"+(e.assertions.length+1)+": "+i.message+" - "+h.jsDump.parse(i));y();e.blocking&&start()}});r(function(){try{var i=e.pollution;y();var k=C(i,e.pollution);if(k.length>0){ok(false,"Introduced global variable(s): "+k.join(", "));e.expected++}var m=C(e.pollution,i);if(m.length>0){ok(false,"Deleted global variable(s): "+m.join(", "));e.expected++}g.teardown.call(g)}catch(n){h.ok(false,"Teardown failed on "+j+": "+n.message)}});r(function(){e.expected&&e.expected!=e.assertions.length&&h.ok(false,
"Expected "+e.expected+" assertions, but "+e.assertions.length+" were run");var i=0,k=0,m=o("qunit-tests");e.stats.all+=e.assertions.length;e.moduleStats.all+=e.assertions.length;if(m){m=document.createElement("ol");for(var n=0;n<e.assertions.length;n++){var q=e.assertions[n],p=document.createElement("li");p.className=q.result?"pass":"fail";p.innerHTML=q.message||(q.result?"okay":"failed");m.appendChild(p);if(q.result)i++;else{k++;e.stats.bad++;e.moduleStats.bad++}}if(k==0)m.style.display="none";
var z=document.createElement("strong");z.innerHTML=j+" <b class='counts'>(<b class='failed'>"+k+"</b>, <b class='passed'>"+i+"</b>, "+e.assertions.length+")</b>";A(z,"click",function(){var s=z.nextSibling;s.style.display=s.style.display==="none"?"block":"none"});A(z,"dblclick",function(s){s=s&&s.target?s.target:l.event.srcElement;if(s.nodeName.toLowerCase()=="span"||s.nodeName.toLowerCase()=="b")s=s.parentNode;if(l.location&&s.nodeName.toLowerCase()==="strong")l.location.search="?"+encodeURIComponent(E([s]).replace(/\(.+\)$/,
"").replace(/(^\s*|\s*$)/g,""))});p=o("current-test-output");p.id="";p.className=k?"fail":"pass";p.style.display=!k&&o("qunit-filter-pass")&&o("qunit-filter-pass").checked?"none":"";p.removeChild(p.firstChild);p.appendChild(z);p.appendChild(m);if(k)if(i=o("qunit-testrunner-toolbar")){i.style.display="block";o("qunit-filter-pass").disabled=null}}else for(n=0;n<e.assertions.length;n++)if(!e.assertions[n].result){k++;e.stats.bad++;e.moduleStats.bad++}try{h.reset()}catch(F){D("reset() failed, following Test "+
j+", exception and reset fn follows",F,h.reset)}h.testDone(b,k,e.assertions.length)});r(u)}},expect:function(b){e.expected=b},ok:function(b,c){b=!!b;var d={result:b,message:c};c=v(c);h.log(b,c,d);e.assertions.push({result:b,message:c})},equal:function(b,c,d){h.push(c==b,b,c,d)},notEqual:function(b,c,d){h.push(c!=b,b,c,d)},deepEqual:function(b,c,d){h.push(h.equiv(b,c),b,c,d)},notDeepEqual:function(b,c,d){h.push(!h.equiv(b,c),b,c,d)},strictEqual:function(b,c,d){h.push(c===b,b,c,d)},notStrictEqual:function(b,
c,d){h.push(c!==b,b,c,d)},raises:function(b,c){try{b();ok(false,c)}catch(d){ok(true,c)}},start:function(){if(B.setTimeout)l.setTimeout(function(){e.timeout&&clearTimeout(e.timeout);e.blocking=false;x()},13);else{e.blocking=false;x()}},stop:function(b){e.blocking=true;if(b&&B.setTimeout)e.timeout=l.setTimeout(function(){h.ok(false,"Test timed out");h.start()},b)}};h.equals=h.equal;h.same=h.deepEqual;var e={queue:[],blocking:true};(function(){for(var b=l.location||{search:"",protocol:"file:"},c=b.search.slice(1).split("&"),
d=0;d<c.length;d++){c[d]=decodeURIComponent(c[d]);if(c[d]==="noglobals"){c.splice(d,1);d--;e.noglobals=true}else if(c[d].search("=")>-1){c.splice(d,1);d--}}e.filters=c;h.isLocal=b.protocol==="file:"})();if(typeof exports==="undefined"||typeof require==="undefined"){t(l,h);l.QUnit=h}else{t(exports,h);exports.QUnit=h}t(h,{config:e,init:function(){t(e,{stats:{all:0,bad:0},moduleStats:{all:0,bad:0},started:+new Date,updateRate:1E3,blocking:false,autostart:true,autorun:false,assertions:[],filters:[],queue:[]});
var b=o("qunit-tests"),c=o("qunit-banner"),d=o("qunit-testresult");if(b)b.innerHTML="";if(c)c.className="";d&&d.parentNode.removeChild(d)},reset:function(){if(l.jQuery)jQuery("#main, #qunit-fixture").html(e.fixture);else{var b=o("main")||o("qunit-fixture");if(b)b.innerHTML=e.fixture}},triggerEvent:function(b,c,d){if(document.createEvent){d=document.createEvent("MouseEvents");d.initMouseEvent(c,true,true,b.ownerDocument.defaultView,0,0,0,0,0,false,false,false,false,0,null);b.dispatchEvent(d)}else b.fireEvent&&
b.fireEvent("on"+c)},is:function(b,c){return h.objectType(c)==b},objectType:function(b){if(typeof b==="undefined")return"undefined";if(b===null)return"null";var c=Object.prototype.toString.call(b).match(/^\[object\s(.*)\]$/)[1]||"";switch(c){case "Number":return isNaN(b)?"nan":"number";case "String":case "Boolean":case "Array":case "Date":case "RegExp":case "Function":return c.toLowerCase()}if(typeof b==="object")return"object"},push:function(b,c,d,f){var j={result:b,message:f,actual:c,expected:d};
f=v(f)||(b?"okay":"failed");f='<span class="test-message">'+f+"</span>";d=v(h.jsDump.parse(d));c=v(h.jsDump.parse(c));var g=f+'<table><tr class="test-expected"><th>Expected: </th><td><pre>'+d+"</pre></td></tr>";if(c!=d){g+='<tr class="test-actual"><th>Result: </th><td><pre>'+c+"</pre></td></tr>";g+='<tr class="test-diff"><th>Diff: </th><td><pre>'+h.diff(d,c)+"</pre></td></tr>"}if(!b){a:{try{throw Error();}catch(a){if(a.stacktrace){c=a.stacktrace.split("\n")[6];break a}else if(a.stack){c=a.stack.split("\n")[4];
break a}}c=void 0}if(c){j.source=c;g+='<tr class="test-source"><th>Source: </th><td><pre>'+c+"</pre></td></tr>"}}g+="</table>";h.log(b,f,j);e.assertions.push({result:!!b,message:g})},begin:function(){},done:function(){},log:function(){},testStart:function(){},testDone:function(){},moduleStart:function(){},moduleDone:function(){}});if(typeof document==="undefined"||document.readyState==="complete")e.autorun=true;A(l,"load",function(){h.begin();var b=t({},e);h.init();t(e,b);e.blocking=false;if(b=o("qunit-userAgent"))b.innerHTML=
navigator.userAgent;if(b=o("qunit-header")){var c=location.href.lastIndexOf(location.search);if(c>-1){c=location.href.slice(0,c);if(c==location.href)b.innerHTML='<a href=""> '+b.innerHTML+"</a> ";else{var d=decodeURIComponent(location.search.slice(1));b.innerHTML='<a href="'+c+'">'+b.innerHTML+'</a> &#8250; <a href="">'+d+"</a>"}}}if(b=o("qunit-testrunner-toolbar")){b.style.display="none";var f=document.createElement("input");f.type="checkbox";f.id="qunit-filter-pass";f.disabled=true;A(f,"click",
function(){for(var j=document.getElementsByTagName("li"),g=0;g<j.length;g++)if(j[g].className.indexOf("pass")>-1)j[g].style.display=f.checked?"none":""});b.appendChild(f);c=document.createElement("label");c.setAttribute("for","qunit-filter-pass");c.innerHTML="Hide passed tests";b.appendChild(c)}if(b=o("main")||o("qunit-fixture"))e.fixture=b.innerHTML;e.autostart&&h.start()});h.equiv=function(){var b,c=[],d=[],f=function(){function j(g,a){return g instanceof a.constructor||a instanceof g.constructor?
a==g:a===g}return{string:j,"boolean":j,number:j,"null":j,undefined:j,nan:function(g){return isNaN(g)},date:function(g,a){return h.objectType(g)==="date"&&a.valueOf()===g.valueOf()},regexp:function(g,a){return h.objectType(g)==="regexp"&&a.source===g.source&&a.global===g.global&&a.ignoreCase===g.ignoreCase&&a.multiline===g.multiline},"function":function(){var g=c[c.length-1];return g!==Object&&typeof g!=="undefined"},array:function(g,a){var i,k,m,n;if(h.objectType(g)!=="array")return false;n=a.length;
if(n!==g.length)return false;d.push(a);for(i=0;i<n;i++){m=false;for(k=0;k<d.length;k++)if(d[k]===a[i])m=true;if(!m&&!b(a[i],g[i])){d.pop();return false}}d.pop();return true},object:function(g,a){var i,k,m,n=true,q=[],p=[];if(a.constructor!==g.constructor)return false;c.push(a.constructor);d.push(a);for(i in a){m=false;for(k=0;k<d.length;k++)if(d[k]===a[i])m=true;q.push(i);if(!m&&!b(a[i],g[i])){n=false;break}}c.pop();d.pop();for(i in g)p.push(i);return n&&b(q.sort(),p.sort())}}}();return b=function(){var j=
Array.prototype.slice.apply(arguments);if(j.length<2)return true;var g;if(j[0]===j[1])g=true;else{if(j[0]===null||j[1]===null||typeof j[0]==="undefined"||typeof j[1]==="undefined"||h.objectType(j[0])!==h.objectType(j[1]))g=false;else{g=[j[1],j[0]];var a=h.objectType(j[0]);g=a?h.objectType(f[a])==="function"?f[a].apply(f,g):f[a]:void 0}g=g}return g&&arguments.callee.apply(this,j.splice(1,j.length-1))}}();h.jsDump=function(){function b(a){return'"'+a.toString().replace(/"/g,'\\"')+'"'}function c(a){return a+
""}function d(a,i,k){var m=g.separator(),n=g.indent(),q=g.indent(1);if(i.join)i=i.join(","+m+q);if(!i)return a+k;return[a,q+i,n+k].join(m)}function f(a){var i=a.length,k=Array(i);for(this.up();i--;)k[i]=this.parse(a[i]);this.down();return d("[",k,"]")}var j=/^function (\w+)/,g={parse:function(a,i){var k=this.parsers[i||this.typeOf(a)];i=typeof k;return i=="function"?k.call(this,a):i=="string"?k:this.parsers.error},typeOf:function(a){return a===null?"null":typeof a==="undefined"?"undefined":h.is("RegExp",
a)?"regexp":h.is("Date",a)?"date":h.is("Function",a)?"function":typeof a.setInterval!==undefined&&typeof a.document!=="undefined"&&typeof a.nodeType==="undefined"?"window":a.nodeType===9?"document":a.nodeType?"node":typeof a==="object"&&typeof a.length==="number"&&a.length>=0?"array":typeof a},separator:function(){return this.multiline?this.HTML?"<br />":"\n":this.HTML?"&nbsp;":" "},indent:function(a){if(!this.multiline)return"";var i=this.indentChar;if(this.HTML)i=i.replace(/\t/g,"   ").replace(/ /g,
"&nbsp;");return Array(this._depth_+(a||0)).join(i)},up:function(a){this._depth_+=a||1},down:function(a){this._depth_-=a||1},setParser:function(a,i){this.parsers[a]=i},quote:b,literal:c,join:d,_depth_:1,parsers:{window:"[Window]",document:"[Document]",error:"[ERROR]",unknown:"[Unknown]","null":"null",undefined:"undefined","function":function(a){var i="function",k="name"in a?a.name:(j.exec(a)||[])[1];if(k)i+=" "+k;i+="(";i=[i,h.jsDump.parse(a,"functionArgs"),"){"].join("");return d(i,h.jsDump.parse(a,
"functionCode"),"}")},array:f,nodelist:f,arguments:f,object:function(a){var i=[];h.jsDump.up();for(var k in a)i.push(h.jsDump.parse(k,"key")+": "+h.jsDump.parse(a[k]));h.jsDump.down();return d("{",i,"}")},node:function(a){var i=h.jsDump.HTML?"&lt;":"<",k=h.jsDump.HTML?"&gt;":">",m=a.nodeName.toLowerCase(),n=i+m,q;for(q in h.jsDump.DOMAttrs){var p=a[h.jsDump.DOMAttrs[q]];if(p)n+=" "+q+"="+h.jsDump.parse(p,"attribute")}return n+k+i+"/"+m+k},functionArgs:function(a){a=a.length;if(!a)return"";for(var i=
Array(a);a--;)i[a]=String.fromCharCode(97+a);return" "+i.join(", ")+" "},key:b,functionCode:"[code]",attribute:b,string:b,date:b,regexp:c,number:c,"boolean":c},DOMAttrs:{id:"id",name:"name","class":"className"},HTML:false,indentChar:"  ",multiline:true};return g}();h.diff=function(){return function(b,c){b=b.replace(/\s+$/,"");c=c.replace(/\s+$/,"");var d;d=b==""?[]:b.split(/\s+/);for(var f=c==""?[]:c.split(/\s+/),j={},g={},a=0;a<f.length;a++){if(j[f[a]]==null)j[f[a]]={rows:[],o:null};j[f[a]].rows.push(a)}for(a=
0;a<d.length;a++){if(g[d[a]]==null)g[d[a]]={rows:[],n:null};g[d[a]].rows.push(a)}for(a in j)if(j[a].rows.length==1&&typeof g[a]!="undefined"&&g[a].rows.length==1){f[j[a].rows[0]]={text:f[j[a].rows[0]],row:g[a].rows[0]};d[g[a].rows[0]]={text:d[g[a].rows[0]],row:j[a].rows[0]}}for(a=0;a<f.length-1;a++)if(f[a].text!=null&&f[a+1].text==null&&f[a].row+1<d.length&&d[f[a].row+1].text==null&&f[a+1]==d[f[a].row+1]){f[a+1]={text:f[a+1],row:f[a].row+1};d[f[a].row+1]={text:d[f[a].row+1],row:a+1}}for(a=f.length-
1;a>0;a--)if(f[a].text!=null&&f[a-1].text==null&&f[a].row>0&&d[f[a].row-1].text==null&&f[a-1]==d[f[a].row-1]){f[a-1]={text:f[a-1],row:f[a].row-1};d[f[a].row-1]={text:d[f[a].row-1],row:a-1}}d={o:d,n:f};f="";j=b.match(/\s+/g);if(j==null)j=[" "];else j.push(" ");g=c.match(/\s+/g);if(g==null)g=[" "];else g.push(" ");if(d.n.length==0)for(a=0;a<d.o.length;a++)f+="<del>"+d.o[a]+j[a]+"</del>";else{if(d.n[0].text==null)for(c=0;c<d.o.length&&d.o[c].text==null;c++)f+="<del>"+d.o[c]+j[c]+"</del>";for(a=0;a<d.n.length;a++)if(d.n[a].text==
null)f+="<ins>"+d.n[a]+g[a]+"</ins>";else{var i="";for(c=d.n[a].row+1;c<d.o.length&&d.o[c].text==null;c++)i+="<del>"+d.o[c]+j[c]+"</del>";f+=" "+d.n[a].text+g[a]+i}}return f}}()})(this);(function(l){TESTS.test_base=function(){module("Base");var u=l.reload,w=l.redirect,v=PAGE.container;test("Reload Form",function(){expect(2);l.reload=function(){ok("reload was called")};var r=l("<form/>");v.append(r);(new Q.ReloadForm(r,{onSuccess:function(){ok("My call back was called!")}}))._onSuccess({});l.reload=u});test("Redirect Form",function(){expect(3);l.redirect=function(x,y){equals(x,"/omgwow/yeah");equals(y,undefined)};var r=l("<form/>");v.append(r);(new Q.RedirectForm(r,{onSuccess:function(){ok("My callback was called!")}}))._onSuccess({results:{url:"/omgwow/yeah"}});
l.redirect=w})}})(jQuery);
